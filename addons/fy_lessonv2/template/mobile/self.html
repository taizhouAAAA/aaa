<!-- 
 * 个人中心
 * ============================================================================
 * 版权所有 2015-2018 微课堂团队，并保留所有权利。
 * 网站地址: https://wx.haoshu888.com
 * ----------------------------------------------------------------------------
 * 这不是一个自由软件！不允许对程序代码以任何形式任何目的的再发布，作者将保留
 * 追究法律责任的权力和最终解释权。
-->
{template '_headerv2'}
<link href="{MODULE_URL}template/mobile/style/cssv2/self.css?v={$versions}" rel="stylesheet" />

<section class="aui-flexView">
	<section class="aui-scrollView">
		<div class="aui-mall-header" {if !empty($config['ucenter_bg'])}style="background-image:url({$_W['attachurl']}{$config['ucenter_bg']});"{/if}>
			<div class="aui-member-info">
				<div id="my-set-avatar" class="aui-member-user">
					<img src="{$avatar}" alt="会员头像">
				</div>
				<div class="aui-flex-box">
					<h2>{php echo $memberinfo['nickname'] ? $memberinfo['nickname'] : '未设置';}</h2>
					<div class="aui-flex-box-yz">{php echo $common['self_page']['studentno'] ? $common['self_page']['studentno'] : '学号';}:{$studentno}</div>
				</div>
				{if $memberVipCount || in_array('vip',$self_item)}
				<div class="aui-member-sign" onclick="location.href='{php echo $this->createMobileUrl('vip');}'">
				</div>
				{/if}
			</div>
			{if in_array('setting',$self_item)}
			<div class="aui-member-setting" onclick="location.href='{php echo url('mc/profile')}'">
				<img src="{MODULE_URL}template/mobile/images/self-icon-setting.png?v=2">
			</div>
			{/if}
		</div>
		<div class="aui-my-wallet">
			<a href="{php echo url('mc/bond/credits', array('credittype' => 'credit1', 'type' => 'record', 'period' => '1'))}" id="go-credit1" class="aui-wallet-item">
				<div class="aui-wallet-number">{$memberinfo['credit1']}</div>
				<div class="aui-wallet-name">
					<h2>{php echo $common['self_page']['credit1'] ? $common['self_page']['credit1'] : '会员积分';}</h2>
				</div>
			</a>
			<a href="{php echo url('mc/bond/credits', array('credittype' => 'credit2', 'type' => 'record', 'period' => '1'))}" id="go-credit2" class="aui-wallet-item">
				<div class="aui-wallet-number">{$memberinfo['credit2']}</div>
				<div class="aui-wallet-name">
					<h2>{php echo $common['self_page']['credit2'] ? $common['self_page']['credit2'] : '会员余额';}</h2>
				</div>
			</a>
			<a href="{php echo $this->createMobileUrl('coupon');}" class="aui-wallet-item">
				<div class="aui-wallet-number">{$coupon_count}</div>
				<div class="aui-wallet-name">
					<h2>优惠券</h2>
				</div>
			</a>
		</div>
		<div class="divHeight"></div>
		<div class="my-all-order">
			<a class="aui-my-order" href="{php echo $this->createMobileUrl('mylesson');}&status=">
				<div class="aui-all-order">全部订单</div>
				<div class="aui-order-dealis">查看全部详情</div>
			</a>
		</div>
		<div class="aui-order-palace clearfix">
			<a href="{php echo $this->createMobileUrl('mylesson',array('status'=>0));}" class="aui-palace-grid">
				<div class="aui-palace-grid-icon">
					<img src="{MODULE_URL}template/mobile/images/self-icon-nopay.png" />
				</div>
				<div class="aui-palace-grid-text">
					<h2>待付款</h2>
				</div>
			</a>
			<a href="{php echo $this->createMobileUrl('mylesson',array('status'=>1));}" class="aui-palace-grid">
				<div class="aui-palace-grid-icon">
					<img src="{MODULE_URL}template/mobile/images/self-icon-pay.png" />
				</div>
				<div class="aui-palace-grid-text">
					<h2>已付款</h2>
				</div>
			</a>
			<a href="{php echo $this->createMobileUrl('mylesson',array('status'=>1,'is_verify'=>0));}" class="aui-palace-grid">
				<div class="aui-palace-grid-icon">
					<img src="{MODULE_URL}template/mobile/images/self-icon-noverify.png" />
				</div>
				<div class="aui-palace-grid-text">
					<h2>未核销</h2>
				</div>
			</a>
			<a href="{php echo $this->createMobileUrl('mylesson',array('status'=>-1));}" class="aui-palace-grid">
				<div class="aui-palace-grid-icon">
					<img src="{MODULE_URL}template/mobile/images/self-icon-cancel.png" />
				</div>
				<div class="aui-palace-grid-text">
					<h2>已取消</h2>
				</div>
			</a>
		</div>
		<div class="divHeight"></div>
		<div class="aui-self-menu">
		{if $memberVipCount || in_array('vip',$self_item)}
			<a class="menu-item" href="{php echo $this->createMobileUrl('vip');}">
				<div class="menu-item-box-hd">
					<img src="{MODULE_URL}template/mobile/images/self-icon-vip-service.png" />
				</div>
				<div class="menu-item-box-name">{php echo $common['self_page']['vip'] ? $common['self_page']['vip'] : 'VIP服务';}</div>
				<div class="menu-item-box-remark"></div>
			</a>
		{/if}
		{if in_array('history',$self_item)}
			<a class="menu-item" href="{php echo $this->createMobileUrl('history');}">
				<div class="menu-item-box-hd">
					<img src="{MODULE_URL}template/mobile/images/self-icon-history.png" />
				</div>
				<div class="menu-item-box-name">{php echo $common['self_page']['history'] ? $common['self_page']['history'] : '我的足迹';}</div>
				<div class="menu-item-box-remark"></div>
			</a>
		{/if}
		{if in_array('lesson',$self_item)}
			<a class="menu-item" href="{php echo $this->createMobileUrl('collect', array('ctype'=>1));}">
				<div class="menu-item-box-hd">
					<img src="{MODULE_URL}template/mobile/images/self-icon-collect-lesson.png" />
				</div>
				<div class="menu-item-box-name">{php echo $common['self_page']['collectLesson'] ? $common['self_page']['collectLesson'] : '收藏课程';}</div>
				<div class="menu-item-box-remark"></div>
			</a>
		{/if}
		{if in_array('teacher',$self_item)}
			<a class="menu-item" href="{php echo $this->createMobileUrl('collect', array('ctype'=>2));}">
				<div class="menu-item-box-hd">
					<img src="{MODULE_URL}template/mobile/images/self-icon-collect-teacher.png?v=2" />
				</div>
				<div class="menu-item-box-name">{php echo $common['self_page']['collectTeacher'] ? $common['self_page']['collectTeacher'] : '收藏讲师';}</div>
				<div class="menu-item-box-remark"></div>
			</a>
		{/if}

		<div class="divHeight"></div>

		{if in_array('teachercenter',$self_item) || !empty($teacher)}
			<a class="menu-item" href="{php echo $this->createMobileUrl('teachercenter');}">
				<div class="menu-item-box-hd">
					<img src="{MODULE_URL}template/mobile/images/self-icon-collect-teachercenter.png" />
				</div>
				<div class="menu-item-box-name">{php echo $common['self_page']['teacherCenter'] ? $common['self_page']['teacherCenter'] : '讲师中心';}</div>
				<div class="menu-item-box-remark"></div>
			</a>
		{/if}
		{if in_array('sale',$self_item) || ($comsetting['is_sale']==1 && (($comsetting['sale_rank']==1) || ($comsetting['sale_rank']==2 && $memberVipCount)))}
			<a class="menu-item" href="{php echo $this->createMobileUrl('commission');}">
				<div class="menu-item-box-hd">
					<img src="{MODULE_URL}template/mobile/images/self-icon-commission.png?v=3" />
				</div>
				<div class="menu-item-box-name">{php echo $font['sale_center'] ? $font['sale_center']:'分销中心';}</div>
				<div class="menu-item-box-remark"></div>
			</a>
		{/if}
		{if in_array('studyDuration',$self_item)}
			<a class="menu-item" href="{php echo $this->createMobileUrl('studyduration');}">
				<div class="menu-item-box-hd">
					<img src="{MODULE_URL}template/mobile/images/self-icon-study-duration.png" />
				</div>
				<div class="menu-item-box-name">{php echo $common['self_page']['studyDuration'] ? $common['self_page']['studyDuration'] : '学习时长';}</div>
				<div class="menu-item-box-remark"></div>
			</a>
		{/if}
		{if in_array('coupon',$self_item)}
			<a class="menu-item" href="{php echo $this->createMobileUrl('coupon');}">
				<div class="menu-item-box-hd">
					<img src="{MODULE_URL}template/mobile/images/self-icon-coupon.png" />
				</div>
				<div class="menu-item-box-name">{php echo $common['self_page']['coupon'] ? $common['self_page']['coupon'] : '优惠券';}</div>
				<div class="menu-item-box-remark"></div>
			</a>
		{/if}
		{if $company_teachers}
			<a class="menu-item" href="{php echo $this->createMobileUrl('company');}">
				<div class="menu-item-box-hd">
					<img src="{MODULE_URL}template/mobile/images/self-icon-company.png" />
				</div>
				<div class="menu-item-box-name">机构中心</div>
				<div class="menu-item-box-remark"></div>
			</a>
		{/if}

		<div class="divHeight"></div>

		{if in_array('mobile',$self_item)}
			<a class="menu-item" href="{php echo $this->createMobileUrl('writemsg', array('op'=>'modifyMobile'));}">
				<div class="menu-item-box-hd">
					<img src="{MODULE_URL}template/mobile/images/self-icon-modify-mobile.png?v=3" />
				</div>
				<div class="menu-item-box-name">{php echo $memberinfo['mobile'] ? '修改':'绑定';}手机</div>
				<div class="menu-item-box-remark"></div>
			</a>
		{/if}

		{if !empty($self_diy)}
		<div class="divHeight"></div>
			{loop $self_diy $item}
			<a class="menu-item" href="{$item['diy_link']}">
				<div class="menu-item-box-hd">
					{if $item['diy_image']}
						<img src="{$_W['attachurl']}{$item['diy_image']}" />
					{else}
						<img src="{MODULE_URL}template/mobile/images/self-icon-diy.png?v=5" />
					{/if}
				</div>
				<div class="menu-item-box-name">{$item['diy_name']}</div>
				<div class="menu-item-box-remark"></div>
			</a>
			{/loop}
		{/if}
		</div>

		{if !$userAgent}
		<div class="logout">
			<a href="{php echo url('mc/home/login_out');}">退出登录</a>
		</div>
		{/if}
	</section>
</section>

<script type="text/javascript">
$("#my-set-avatar").click(function(){
	var agent = <?php echo $agent; ?>;
	if(!agent){
		return;
	}
	if(!confirm('更新头像信息?')){
		return;
	}
	location.href = "{php echo $this->createMobileUrl('self', array('updateInfo'=>1));}";
});

document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
	var miniprogram_environment = false;
	wx.miniProgram.getEnv(function(res) {
		if(res.miniprogram) {
			miniprogram_environment = true;
		}
	})
	if(window.__wxjs_environment === 'miniprogram' || miniprogram_environment) {
		$("#mc-profile").hide();
		$("#go-credit1").attr("href","javascript:;");
		$("#go-credit2").attr("href","javascript:;");
	}
});
</script>

{template '_footerv2'}